# Malware-Analysis-Lab

<h2>Description</h2>
Project is an isolated self-hosted virtual machine customized for dynamic malware analysis of host-based indicators &  an accompanying C2 VM for Network-Based indicators.
<br />


<h2>Languages and Utilities Used</h2>

- <b>Linux</b> 
- <b>OracleVM Virtual Box</b>

<h2>Environments Used </h2>

- <b>Windows 10x64-bit</b> 
- <b>Hard Disk: 100 GB, Split</b>
- <b>RAM: 4 GB</b> 
- <b>Network: Host Only Adapter</b> 


<br />

<p align="center"><h2>Project Workflow:</h2>
<p align="center">
<h2>1) Installed Operating system after creating an ISO image and customize its hardware for malware analysis: </h2><br/>
   
    Took Base Install Snapshot

<h2>2) Downloaded Software onto VM </h2><br/>

          VM-Flare Toolkit
          Systernal Toolkit

<br />
<br />
Downloaded Utility Software to disguise VM from attackers that scan for dynamic analysis machines: <br/>
</br>

          Microsoft Office
          Adobe Reader
          Browsers (Chrome, Firefox)
          WinRAR
          Text Editors (Notepad++, Sublime Text etc.)

<br />
<br />
Download debugger to learn the working structure of the malware and disable some prevention mechanisms by making changes to the malware codes: <br/>
<br/>  
  
          Ollydbg
          X64dbg
          Windbg
          Radare2
<br/>
<br />
Downloaded Network monitoring tools to detect network activities of the malware: <br/>
<br/>

        	Wireshark
        	Fiddler
        	Burp Suite

Downloaded process monitoring tools with features best suited to malware analysis: <br/>
<br/>

        	Process Hacker
        	Process Explorer (SysInternals)
        	Procmon (SysInternals)

Downloaded File activity monitoring tools to detect and indicate malicious activities by malware for an analysis report: <br/>
<br/>
    	  
           Sysmon

Other tools: <br/>
<br/>

        	SysInternal Tools
        	CFF Explorer
        	PEView
        	TriDNet
        	BinText
        	PEiD
        	Regshot - Registry Analysis
        	HashMyFiles
  <br/>
<h2>3) Configured VM for malware analysis lab:
</h2><br/>
<h3></h3>I. Turned off Windows Defender by disabling all active settings through Group Policy

    	a) Navigated to gpedit.mcs > Computer Configuration > Administrative Templates > Windows Components > Microsoft Defender Antivirus
    	b) Set "Turn off Microsoft Defender Antivirus" policy to "Enabled"
    	c) Navigated to "Real-time Protection" under "Microsoft Defender Antivirus"
    	d) Set "Monitor file and program activity on your computer" policy to "Disabled"



<h3>II. Renamed VM and Username to appear as a normal user in order to avoid anti-analysis techniques that scan for analysis environments</h3> <br/>
<br/>

<h3>III. Turned off auto-updates through Group Policy in order for the malware to run as normally as possible
</h3>

    	a) Navigated to gpedit.mcs > Computer Configuration > Administrative Templates > Windows Components > Windows Update
    	b) Set "Configure Automatic Updates" policy to "Disabled"

<h3>IV. Disabled hidden extensions to avoid confusion during analysis by malware that takes advantage of Windows hiding known file extensions</h3>

    	a) Navigated to File Explorer > File > Change folder and search options
    	b) Navigated to "View" tab and unchecked "Hide extensions for known file types" and saved settings

<h3>V. Enabled Windows to Show Hidden Files and Folders to perform a better analysis
</h3>

    	a) Navigated to File Explorer > File > Change folder and search options
    	b) Navigated to "View" tab and checked "Show Hidden Files, Folders, and Drives" and saved settings    

<h3>VI. Disabled Windows anti-exploit security mechanism ASLR through the Registry Editor</h3>

    	a) Navigated to HKEY_LOCAL_MACHINE > SYSTEM > CurrentControlSet > Control > Session Manager > Memory Management
    	b) Created a “REG_DWORD” type key in "Memory Management" and named it “MoveImages" to disable ASLR feature

<h3>VII. Disabled Windows Firewall to prevent the security mechanisms from interfering with the analysis of malicious software</h3>

    	a) Navigated to Control Panel > System and Security > Windows Defender Firewall > Customize Settings
    	b) Clicked "Turn off Windows Defender Firewall" to disable the firewall in both Public and Private Network settings

<h3>VIII. Mimicked an End-User System by making VM look like a normal OS so that the malware being analyzed is not caught by anti-analysis techniques:</h3>


      Installed browsers frequently preferred by end-users
      Left files in different directories that will be of interest to the attacker
      Changed the desktop background
      Downloaded small applications through the browser to ensure that some files are found in the Downloads directory

<h3>IX. Changed Network Settings to prevent malware from spreading to different devices via network connection</h3>


    	a) Navigated to VM hardware settings in VirtualBox
    	b) Selected "Custom Settings" for specific virtual network in Network Adapter

<h3>X. Took a snapshot to switch to the same analysis environment with a clean VM after an analysis</h3>

    	a) Navigated to Snapshot manager and left detailed notes for easy navigation

<br/>
<br/>

<h2>4)Used Windows VM for host-based indicators and Linux VM for network-based indicators<br/>
<br/>
</h2><br/>
<h2>5) Set up an internet simulator (INetSim) on Linux VM to monitor and record malicious network traffic<br/>
</h2><br/>

<h2>Setting up a Self-Hosted Isolated Network</h2><br/>
Steps:

    1) Tools > Network Settings > Create > Configure Adapter Manually
    
    2) Set IPv4 to 10.0.0.1, leave subnet mask as a /24
    
    3) Enabled DHCP server and set server address to 10.0.0.2, left subnet mask as a /24, set lower bound to 10.0.0.3 and upper bound to 10.0.0.254
    
    4) Set Windows Lab and REMnux C2 to the same Host-Only Network Adapter
    
    5) Tested both VMs by pinging each other and the internet.
    
    6) Configured Linux VM ethernet Network adapter to the hosted server address to match the InetSIM tool.




<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
